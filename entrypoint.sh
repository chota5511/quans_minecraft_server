#!/bin/sh

echo '
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                                                                                │
│                  (((((                                                                                                                                         │
│             ##((//(((((####                 ____                   _          __  ____                            ______     _____                             │
│        ((((////(((((((/(#(((//((           / __ \__  ______ _____ ( )_____   /  │/  (_)___  ___  ______________ _/ __/ /_   / ___/___  ______   _____  _____   │
│   (((((##(((((/(/#(/(/(/((//(((##((((     / / / / / / / __ `/ __ \│// ___/  / /│_/ / / __ \/ _ \/ ___/ ___/ __ `/ /_/ __/   \__ \/ _ \/ ___/ │ / / _ \/ ___/   │
│   /(((((((((//##(((/(/((((((((((((((#    / /_/ / /_/ / /_/ / / / / (__  )  / /  / / / / / /  __/ /__/ /  / /_/ / __/ /_    ___/ /  __/ /   │ │/ /  __/ /       │
│   ###*((%((/(##(((((/(##((#((///%#%##    \___\_\__,_/\__,_/_/ /_/ /____/  /_/  /_/_/_/ /_/\___/\___/_/   \__,_/_/  \__/   /____/\___/_/    │___/\___/_/        │
│   #%%(/#%%%(//(((#((((((/%(%(%(##(#/(                                                                                                                          │
│   /(####(%#%%(%%#((((#*((%##%####(((#                                                                                                                          │
│   ((##(((#//##%#(%#%##(/#(%//%((###((       ______              ____             __                ______            __        _                               │
│   (#(#/#%#%#%((#(#/#%%##((#%####(((%%      / ____/___  _____   / __ \____  _____/ /_____  _____   / ____/___  ____  / /_____ _(_)___  ___  _____               │
│   ##%(#(//(%#####((/(##(#%%(%/(###/((     / /_  / __ \/ ___/  / / / / __ \/ ___/ //_/ _ \/ ___/  / /   / __ \/ __ \/ __/ __ `/ / __ \/ _ \/ ___/               │
│   (##%(%#/##((#((#(((##///####/%##(%%    / __/ / /_/ / /     / /_/ / /_/ / /__/ ,< /  __/ /     / /___/ /_/ / / / / /_/ /_/ / / / / /  __/ /                   │
│       ((##%#%/####%(##(#(#(#####(       /_/    \____/_/     /_____/\____/\___/_/│_│\___/_/      \____/\____/_/ /_/\__/\__,_/_/_/ /_/\___/_/                    │
│            ((#%#(((##(%/##/(                                                                                                                                   │
│                 (#%(##/                                                                                                                                        │
│                                                                                                                                                                │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘'
echo "Wecome to Quan Nguyen's Minecraft Server for Docker container



"


echo "Get memory configuration from ENV"
if [ -f "/run_mc.sh" ]; then
    sed -i "s/@min_mem/$min_mem/g" /run_mc.sh
    sed -i "s/@max_mem/$max_mem/g" /run_mc.sh
else
    sed -i "s/@min_mem/$min_mem/g" /mcfile/run_mc.sh
    sed -i "s/@max_mem/$max_mem/g" /mcfile/run_mc.sh
fi

if [ -f "/mcfile/init.sh" ]; then
    echo "System already has first time initialed"
    if [ -f "/init.sh" ]; then
        echo "Recreate detected, run recreate initializing"
        rm -rf /server.jar
        rm -rf /run_mc.sh
        rm -rf /init.sh
        rm -rf /reload_server_properties.sh
        sed -i "s/initFlag=false/initFlag=true/g" /mcfile/init.sh
        /mcfile/init.sh
    fi
else
    /init.sh
fi

/mcfile/reload_server_properties.sh

echo "Starting Minecraft Server"
/mcfile/run_mc.sh